# è£…é¥°å™¨

> åˆšè¿›æ¥åš `Entry Task` çš„æ—¶å€™ï¼Œéœ€è¦ç”¨ `typescript`ï¼Œä¹‹å‰æœ‰çœ‹è¿‡ä¸€äº›æ–‡ç« ï¼Œç”¨åˆ°é¡¹ç›®ä¸­ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ï¼Œç»“åˆ `vue` çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€äº›å†™æ³•ç±»ä¼¼ `@Component` `@Prop`ã€‚æŸ¥é˜…ä¸€ç•ªäº†è§£åˆ°æ˜¯`è£…é¥°å™¨`ã€‚

## ä¸€ã€èƒŒæ™¯

ç¬¬ä¸€æ¬¡äº†è§£åˆ°è¿™ç§ç”¨æ³•çš„æ—¶å€™ï¼Œæˆ‘æ˜¯è§‰å¾—è£…é¥°å™¨è¿™ç§ä¸œè¥¿æ˜¯å¾ˆå¥‡ç‰¹çš„ï¼Œå†™èµ·æ¥ä¹Ÿå¾ˆèˆ’æœã€‚ä»¥å‰å†™è¿‡çš„é¡¹ç›®å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°è¿™ç§å†™æ³•ï¼Œç½‘ä¸Šä¸€æœï¼Œä¼¼ä¹å…³äº js è£…é¥°å™¨çš„æ–‡ç« ä¹Ÿå¹¶ä¸æ˜¯å¾ˆç«ï¼ŒæŸ¥çœ‹äº†æ–‡æ¡£æˆ‘æƒ³ä¸ç«çš„åŸå› æ˜¯è¿™æ ·å§ï¼š

è£…é¥°å™¨æ—©åœ¨2016å¹´çš„æ—¶å€™ï¼ŒES7å°±æœ‰è¿™ä¸ª[ææ¡ˆ](https://github.com/tc39/proposal-decorators)ï¼Œç„¶è€Œç›´åˆ°ç°åœ¨ï¼Œ`Decorator ææ¡ˆç»è¿‡äº†å¤§å¹…ä¿®æ”¹ï¼Œç›®å‰è¿˜æ²¡æœ‰å®šæ¡ˆï¼Œç°æœ‰çš„ä¸€äº›è¯­æ³•å¯èƒ½è¿˜ä¼šå¤§å¹…åº¦ä¿®æ”¹`ã€‚ä¸è¿‡åœ¨ `Bable` çš„å¤„ç†ä¸‹ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚

åœ¨ Typescript ä¸­ï¼Œè£…é¥°å™¨ä½œä¸ºä¸€é¡¹å®éªŒæ€§ç‰¹æ€§ï¼Œç›®å‰å¤„åœ¨ å»ºè®®[å¾é›†çš„ç¬¬äºŒé˜¶æ®µ](https://github.com/tc39/proposal-decorators)

> åœ¨æ–°ç‰ˆVue-clié¡¹ç›®ä¸­å·²ç»é»˜è®¤æ”¯æŒDecoratorå†™æ³•äº†

## äºŒã€æ˜¯ä»€ä¹ˆ

### 1. é¢˜å¤–è¯ AOPâ€”â€”é¢å‘åˆ‡é¢ç¼–ç¨‹

AOPå…¨ç§° `Aspect Oriented Programming` æ„ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä¹Ÿå«åšé¢å‘æ–¹æ³•ç¼–ç¨‹ï¼Œæ˜¯é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç°**ä¸ä¿®æ”¹æºä»£ç **çš„æƒ…å†µä¸‹ç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ åŠŸèƒ½çš„æŠ€æœ¯ã€‚

åœ¨å‰ç«¯çš„å¸¸è§éœ€æ±‚ä¸­ï¼Œæœ‰ä»¥ä¸‹ä¸€äº›ä¸šåŠ¡å¯ä»¥ä½¿ç”¨ AOP å°†å…¶ä»æ ¸å¿ƒå…³æ³¨ç‚¹ä¸­åˆ†ç¦»å‡ºæ¥

- Node.js æ—¥å¿—log
- åŸ‹ç‚¹ã€æ•°æ®ä¸ŠæŠ¥
- æ€§èƒ½åˆ†æã€ç»Ÿè®¡å‡½æ•°æ‰§è¡Œæ—¶é—´
- ç»™ajaxè¯·æ±‚åŠ¨æ€æ·»åŠ å‚æ•°ã€åŠ¨æ€æ”¹å˜å‡½æ•°å‚æ•°
- åˆ†ç¦»è¡¨å•è¯·æ±‚å’ŒéªŒè¯
- é˜²æŠ–ä¸èŠ‚æµ

### 2. è£…é¥°è€…æ¨¡å¼

åœ¨è°ˆåŠè£…é¥°å™¨çš„æ—¶å€™ï¼Œä¸å¾—ä¸è¯´çš„å°±æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼š**è£…é¥°è€…æ¨¡å¼**

è£…é¥°è€…æ¨¡å¼ï¼šåœ¨ä¸æ”¹å˜åŸå¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¯¹å…¶è¿›è¡ŒåŒ…è£…æ‰©å±•ï¼ˆæ·»åŠ å±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œä½¿åŸæœ‰å¯¹è±¡å¯ä»¥æ»¡è¶³ç”¨æˆ·çš„æ›´å¤æ‚éœ€æ±‚ã€‚

å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œè£…é¥°å™¨çš„æ€æƒ³æ­£æ˜¯ AOP çš„æ€æƒ³ï¼Œå› æ­¤ AOP ç»å¸¸ä¼šå’Œè£…é¥°å™¨æ¨¡å¼æ··ä¸ºä¸€è°ˆã€‚

**åœºæ™¯1ï¼š**

å‡å¦‚éœ€è¦åœ¨ä¸€äº›ç‰¹å®šçš„å‡½æ•°ä¸Šæ·»åŠ ä¸€ä¸ªåŠŸèƒ½â€”â€”è®¡ç®—å‡½æ•°çš„åç§°ä»¥åŠå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚

æˆ‘ä»¬å¯èƒ½ä¼šåœ¨æ¯ä¸ªå‡½æ•°ä¸‹å»æ·»åŠ è¿™æ ·çš„ä»£ç 

```js
function doSomethingOne(name) {
  console.time(wrapped);
  console.log('doSomethingOne: Hello, ' + name);
  console.timeEnd(wrapped);
}
function doSomethingTwo(name) {
  console.time(wrapped);
  console.log('doSomethingTwo: Hello, ' + name);
  console.timeEnd(wrapped);
}
function doSomethingThree(name) {
  console.time(wrapped);
  console.log('doSomethingThree: Hello, ' + name);
  console.timeEnd(wrapped);
}
```

é‚£å¦‚æœä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥ç¼–å†™çš„è¯

```js
function doSomething(name) {
  console.log('Hello, ' + name);
}

function loggingDecorator(wrapped) {
  return function() {
    console.time(wrapped);
    const result = wrapped.apply(this, arguments);
    console.timeEnd(wrapped);
    return result;
  }
}

const wrapped = loggingDecorator(doSomething);
```

### 3. è£…é¥°å™¨

è£…é¥°å™¨å…¶å®å°±åƒæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªå¢åŠ åŠŸèƒ½çš„ç»„ä»¶ï¼Œç©è¿‡åƒé¸¡çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼Œæˆ‘ä»¬æ¡è£…å¤‡çš„æ—¶å€™ï¼Œå…ˆæ˜¯éœ€è¦ä¸€æŠŠæªï¼Œå½“çœ‹åˆ°æ¡æŠŠã€æªå£ã€æˆ–è€…æ˜¯å¼¹å¤¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ¡èµ·æ¥è£…åœ¨è‡ªå·±çš„æªä¸Šï¼Œæ¯ä¸€ä¸ªé…ä»¶éƒ½æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œåªä¸è¿‡åŠŸèƒ½ä¸åŒï¼Œæ•ˆæœä¸ä¸€æ ·ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ä¼šæ ¹æ®è‡ªå·±çš„éœ€è¦å»è£…å¤‡ `ï¼ˆæªå£ï¼‰è£…é¥°å™¨`ï¼š

![](assets/gun.png)

åŒæ ·çš„ï¼Œåœ¨ä»£ç ä¸Šï¼Œä¸€ä¸ªè£…é¥°å™¨å¯ä»¥è£…é¥°`ç±»`ï¼Œæˆ–è€…è£…é¥°ç±»çš„`æ–¹æ³•`

ä¾‹å­ğŸŒ°ï¼š
```js
// å…ˆå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ˜¯ç”¨æ¥è®¡ç®—å¦å¤–ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´
export const time = (label: string) => { // è£…é¥°å™¨å·¥å‚
  return function decorator(target:any, propertyKey: string, descriptor: any) { // è£…é¥°å™¨
    const fn = descriptor.value;

    console.time(label);
    try {
      return fn.apply(arguments);
    } finally {
      console.timeEnd(label);
    }
  }
}

@time('vue-mounted')
mounted() {
  let n = 0;
  while(n < 10000000) {
    n++;
  }
}
```
è¯¥ `demo` çš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š
![](assets/@time.png)

## ä¸‰ã€ç”¨æ³•

### Typescriptä¸­çš„ç”¨æ³•

ç›®å‰ï¼Œ`decorator` ä¸ºè¯•éªŒæ€§ç‰¹æ€§ï¼Œä¸ºäº†èƒ½åœ¨ `ts` ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `tsconfig.json` ä¸­è¿›è¡Œé…ç½®

```
"experimentalDecorators": true,
```

å…ˆæ¥çœ‹ Vue + typescript æ˜¯æ€ä¹ˆç»“åˆçš„å§

```ts
<script lang="ts">
import { Component, Prop, Vue } from 'vue-property-decorator';

@Component
export default class HelloWorld extends Vue {
  @Prop() private msg!: string;
}
</script>
```

#### 1. ç±»è£…é¥°å™¨


å¯ä»¥çœ‹åˆ° `class HelloWorld` ä¸Šé¢ä¸€è¡Œä»£ç å†™äº†è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ `@Component`ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªç±»è£…é¥°å™¨ï¼Œâ€å‘ŠçŸ¥â€œæˆ‘ä»¬è¿™ä¸ªç±»æ˜¯ä¸€ä¸ª Vue çš„ Component çš„ç±»ã€‚ï¼ˆå®é™…ä¸Šå°±æ˜¯æŠŠæ™®é€šç±»å˜æˆ Vue çš„ Componentï¼‰

> Component è£…é¥°å™¨æ¥è‡ª Vue å®˜æ–¹ çš„ `vue-class-component` åº“

æ¥çœ‹ä¸€ä¸‹ä»–æ˜¯åšäº†å“ªäº›å·¥ä½œå§ï¼š

```js
function Component <V extends Vue>(options: ComponentOptions<V> & ThisType<V>): <VC extends VueClass<V>>(target: VC) => VC
function Component <VC extends VueClass<Vue>>(target: VC): VC
function Component (options: ComponentOptions<Vue> | VueClass<Vue>): any {
  if (typeof options === 'function') {
    return componentFactory(options)
  }
  return function (Component: VueClass<Vue>) {
    return componentFactory(Component, options)
  }
}
```

> ä¸Šé¢æ˜¯ TS çš„é‡è½½ã€‚

è¿™é‡Œæœ‰ä¸ªå‡½æ•° `componentFactory`ï¼Œè¿™ä¸ªå‡½æ•°çš„å·¥ä½œå°±æ˜¯å°†æˆ‘ä»¬ä¼ è¿›æ¥çš„å‚æ•°åšå¤„ç†ï¼Œæœ€åè¿”å›ä¸€ä¸ª Vue Component ç»„ä»¶ã€‚

**ç‰¹ç‚¹ï¼š**
- åœ¨ç±»å£°æ˜ä¹‹å‰è¢«å£°æ˜
- è¿è¡Œæ—¶è¢«å½“ä½œå‡½æ•°è°ƒç”¨ï¼Œç±»çš„æ„é€ å‡½æ•°ä½œä¸ºå”¯ä¸€å‚æ•°

ä¸Šé¢çš„ Component å‡½æ•°å…¶å®ä¸æ˜¯è£…é¥°å™¨ï¼Œï¼Œä»–æ˜¯ä¸€ä¸ªè£…é¥°å™¨å·¥å‚ï¼Œé‡Œé¢çš„æ‰æ˜¯è£…é¥°å™¨ã€‚

```js
// è£…é¥°å™¨å·¥å‚
function Component (options: ComponentOptions<Vue> | VueClass<Vue>): any {
  // è£…é¥°å™¨
  return function (Component: VueClass<Vue>) {
    return componentFactory(Component, options)
  }
}
```

è¿™é‡Œçš„ `Component` ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼ŒåŠ ä¸Š `options`ï¼Œä¼ ç»™ `componentFactory` åšå¤„ç†ã€‚

#### 2. å±æ€§è£…é¥°å™¨

å±æ€§è£…é¥°å™¨è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶å½“ä½œå‡½æ•°è¢«è°ƒç”¨ï¼Œä¼ å…¥ä¸‹åˆ—2ä¸ªå‚æ•°ï¼š

- å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚
- æˆå‘˜çš„åå­—ã€‚

æœ‰æ—¶å€™ï¼Œå±æ€§è£…é¥°å™¨ä¼šé€šè¿‡è£…é¥°å™¨å·¥å‚åŒ…èµ·æ¥ï¼Œæ¥çœ‹çœ‹ `Prop` çš„å®ç°å§ï¼š

```js
/**
 * decorator of a prop
 * @param  options the options for the prop
 * @return PropertyDecorator | void
 */
export function Prop(options: PropOptions | Constructor[] | Constructor = {}) {
  return (target: Vue, key: string) => {
    applyMetadata(options, target, key)
    createDecorator((componentOptions, k) => {
      ;(componentOptions.props || ((componentOptions.props = {}) as any))[
        k
      ] = options
    })(target, key)
  }
}
```

è¿™é‡ŒåŒæ ·æ˜¯è£…é¥°å™¨å·¥å‚å’Œè£…é¥°å™¨çš„æ¨¡å¼ï¼Œè£…é¥°å™¨ä¸­æ‰§è¡Œäº†ä¸¤ä¸ªæ–¹æ³•ï¼Œ`applyMetadata` å’Œ `createDecorator`

ç¬¬ä¸€ä¸ªæ–¹æ³•ä¸»è¦æ˜¯å®šä¹‰ options çš„ç±»å‹

ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ `vue-class-component` æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼š

```js
export function createDecorator(factory) {
  return (target, key, index) => {
    const Ctor = typeof target === 'function'
        ? target
        : target.constructor;
    if (!Ctor.__decorators__) {
        Ctor.__decorators__ = [];
    }
    if (typeof index !== 'number') {
        index = undefined;
    }
    Ctor.__decorators__.push(options => factory(options, key, index));
  };
}
```

#### 3. æ–¹æ³•è£…é¥°å™¨ï¼ˆEmitï¼‰

æ–¹æ³•è£…é¥°å™¨è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶å½“ä½œå‡½æ•°è¢«è°ƒç”¨ï¼Œä¼ å…¥ä¸‹åˆ—3ä¸ªå‚æ•°ï¼š

- å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚
- æˆå‘˜çš„åå­—ã€‚
- æˆå‘˜çš„å±æ€§æè¿°ç¬¦ã€‚


åœ¨ `vue-property-decorator` ä¸­ä»‹ç»äº† `Emit` çš„ç”¨æ³•å¦‚ä¸‹
```js
@Component
export default class YourComponent extends Vue {
  count = 0

  @Emit()
  addToCount(n: number) {
    this.count += n
  }

  @Emit('reset')
  resetCount() {
    this.count = 0
  }

  @Emit()
  returnValue() {
    return 10
  }

  @Emit()
  onInputChange(e) {
    return e.target.value
  }

  @Emit()
  promise() {
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(20)
      }, 0)
    })
  }
}
```

ä»¥ä¸Šä»£ç ç­‰åŒäº

```js
export default {
  data() {
    return {
      count: 0,
    }
  },
  methods: {
    addToCount(n) {
      this.count += n
      this.$emit('add-to-count', n)
    },
    resetCount() {
      this.count = 0
      this.$emit('reset')
    },
    returnValue() {
      this.$emit('return-value', 10)
    },
    onInputChange(e) {
      this.$emit('on-input-change', e.target.value, e)
    },
    promise() {
      const promise = new Promise((resolve) => {
        setTimeout(() => {
          resolve(20)
        }, 0)
      })

      promise.then((value) => {
        this.$emit('promise', value)
      })
    },
  },
}
```

çœ‹ä¸€ä¸‹å®ç°çš„åŸç†å§ï¼š

```js
/**
 * decorator of an event-emitter function
 * @param  event The name of the event
 * @return MethodDecorator
 */
export function Emit(event?: string) {
  return function (_target: Vue, propertyKey: string, descriptor: any) {
    const key = hyphenate(propertyKey)
    const original = descriptor.value
    descriptor.value = function emitter(...args: any[]) {
      const emit = (returnValue: any) => {
        const emitName = event || key

        if (returnValue === undefined) {
          if (args.length === 0) {
            this.$emit(emitName)
          } else if (args.length === 1) {
            this.$emit(emitName, args[0])
          } else {
            this.$emit(emitName, ...args)
          }
        } else {
          args.unshift(returnValue);
          this.$emit(emitName, ...args)
        }
      }

      const returnValue: any = original.apply(this, args)

      if (isPromise(returnValue)) {
        returnValue.then(emit)
      } else {
        emit(returnValue)
      }

      return returnValue
    }
  }
}
```

è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆçœ‹ä½ æœ‰æ²¡æœ‰ä¼ å‚æ•°ï¼ˆeventï¼‰è¿›æ¥ï¼Œæœ‰çš„è¯ï¼Œå‚æ•°å°†ä½œä¸º `this.$emit` çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦åˆ™å°±æ˜¯ä¼šé»˜è®¤å°†å½“å‰å‡½æ•°çš„åç§°ï¼ˆè½¬æ¢ä¸ºxxx-xxxï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚

#### 4. è®¿é—®å™¨è£…é¥°å™¨

TypeScriptä¸å…è®¸åŒæ—¶è£…é¥°ä¸€ä¸ªæˆå‘˜çš„getå’Œsetè®¿é—®å™¨ã€‚ä¸€ä¸ªæˆå‘˜çš„æ‰€æœ‰è£…é¥°çš„å¿…é¡»åº”ç”¨åœ¨æ–‡æ¡£é¡ºåºçš„ç¬¬ä¸€ä¸ªè®¿é—®å™¨ä¸Šã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨è£…é¥°å™¨åº”ç”¨äºä¸€ä¸ªå±æ€§æè¿°ç¬¦æ—¶ï¼Œå®ƒè”åˆäº†getå’Œsetè®¿é—®å™¨ï¼Œè€Œä¸æ˜¯åˆ†å¼€å£°æ˜çš„

å‚æ•°

- å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚
- æˆå‘˜çš„åå­—ã€‚
- æˆå‘˜çš„å±æ€§æè¿°ç¬¦ã€‚

```ts
class Point {
    private _x: number;
    private _y: number;
    constructor(x: number, y: number) {
        this._x = x;
        this._y = y;
    }

    @configurable(false)
    get x() { return this._x; }

    @configurable(false) // Error: Decorators cannot be applied to multiple get/set accessors of the same name.
    set x(val) { this._x = val }

    @configurable(false)
    get y() { return this._y; }
}

function configurable(value: boolean) {
    return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {
        descriptor.configurable = value;
    };
}
```


#### 5. å‚æ•°è£…é¥°å™¨

å‚æ•°

- å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚
- æˆå‘˜çš„åå­—ã€‚
- å‚æ•°åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­çš„ç´¢å¼•ã€‚

## å››ã€vue-property-decorator

è¿™ä¸ªåº“åŸºäº `vue-class-component`ï¼Œå†å®šä¹‰äº†ä¸€äº›å…¶ä»–çš„è£…é¥°å™¨ï¼Œ

- @Prop
- @PropSync
- @Model
- @Watch
- @Provide
- @Inject
- @ProvideReactive
- @InjectReactive
- @Emit
- @Ref
- @Component (provided by vue-class-component)
- Mixins (the helper function named mixins provided by vue-class-component)

ä¸Šé¢ä¹Ÿç®€å•ä»‹ç»äº†å‡ ä¸ªè£…é¥°å™¨çš„ç”¨æ³•å’Œç®€ç•¥çš„è¯´æ˜äº†åŸç†ï¼Œä¸‹é¢å†ä»‹ç»å…¶ä»–ä¸€äº›ç›¸å…³çš„ä¸œè¥¿ã€‚

1ã€ `createDecorator`

`createDecorator` æ˜¯ç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰è£…é¥°å™¨çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°æ¥æ”¶ä¸€ä¸‹å‚æ•°ï¼š

- `options`ï¼šVueç»„ä»¶é€‰é¡¹å¯¹è±¡ã€‚å¯¹è¯¥å¯¹è±¡æ‰€åšçš„æ›´æ”¹å°†å½±å“æ‰€æä¾›çš„ç»„ä»¶ã€‚
- `key`ï¼šåº”ç”¨è£…é¥°å™¨çš„å±æ€§æˆ–æ–¹æ³•é”®ã€‚
- `parameterIndex`ï¼šå¦‚æœè‡ªå®šä¹‰ä¿®é¥°ç¬¦ç”¨äºå‚æ•°ï¼Œåˆ™ä¿®é¥°å‚æ•°çš„ç´¢å¼•ã€‚


```js
import { createDecorator } from 'vue-class-component';
import { errorReport } from '@/utils/tools';

export const tryCatch = createDecorator((options: any, key: string) => {
  const originalMethod = options.methods[key];

  options.methods[key] = async function (...args: any) {
    try {
      await originalMethod.apply(this, args);
    } catch (error) {
      console.log('trycatch: ', error);
      errorReport(error);
    }
  };
});
```

ä½¿ç”¨åœºæ™¯

é¡¹ç›®ä¸­ async await ç”¨çš„ä¹Ÿç®—æ˜¯ä¸å°‘äº†ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œasync await çš„å¼‚å¸¸æ•è·å¹¶ä¸åƒ Promise ä¸€æ ·å¯ä»¥é“¾å¼ cacthï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨ try catch åŒ…è£¹ä½ä»£ç ã€‚ç„¶è€Œä»£ç ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯è¿™æ ·çš„ä»£ç ã€‚

```js
try {
  await xxxxx;
} catch(e) {
  console.log(e);
}
```

å…¶å®ä¹Ÿæ˜¯å¯ä»¥ç”¨è£…é¥°å™¨æ¥åŒ…è£…å‡½æ•°çš„

```js
import { createDecorator } from 'vue-class-component';

export const tryCatch = createDecorator((options: any, key: string) => {
  const originalMethod = options.methods[key];

  options.methods[key] = async function (...args: any) {
    console.log(`Invoked: ${key}(`, ...args, ')');
    try {
      await originalMethod.apply(this, args);
    } catch (error) {
      console.log('trycatch: ', error);
    }
  };
});
```

ä½¿ç”¨çš„è¯å¯ä»¥è¿™æ ·

```ts
@tryCatch
mounted() {
  getList();
}
```

## é™„å½•
- [åœ¨JavaScriptä¸­è¿›è¡Œé¢å‘åˆ‡é¢ç¼–ç¨‹](https://juejin.im/post/5cc2e15651882525041c64b5)
- [Typescriptå®˜æ–¹æ–‡æ¡£](https://www.tslang.cn/docs/handbook/decorators.html)
- [vue-property-decoratorä»“åº“](https://github.com/kaorun343/vue-property-decorator)